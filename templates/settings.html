{% extends "base.html" %}
{% block content %}
    <h1>Settings</h1>
    <form id="rules_form" method="POST">
        <div id="rules_container">
            <!-- Render existing rules -->
            {% for rule in rules_list %}
            <div class="rule_row">
                <input type="hidden" name="rule_id" value="{{ rule.id }}">
                <input type="text" name="rule_name" placeholder="Rule Name (letters only)" value="{{ rule.name }}" required>
                <select name="rule_parameter" required>
                    <option value="">Select Parameter</option>
                    {% for parameter in parameters %}
                        <option value="{{ parameter[0] }}" {% if parameter[0] == rule.parameter %} selected {% endif %}>{{ parameter[1] }}</option>
                    {% endfor %}
                </select>
                <select name="rule_action[]" required>
                    <option value="">Select Action</option>
                    <option value="<" {% if rule.action == '<' %} selected {% endif %}>&lt;</option>
                    <option value=">" {% if rule.action == '>' %} selected {% endif %}>&gt;</option>
                    <option value="=" {% if rule.action == '=' %} selected {% endif %}>=</option>
                    <option value="<=" {% if rule.action == '<=' %} selected {% endif %}>&le;</option>
                    <option value=">=" {% if rule.action == '>=' %} selected {% endif %}>&ge;</option>
                </select>
                <input type="number" name="rule_amount" placeholder="Amount (positive number)" min="0" value="{{ rule.amount }}" required>
                <input type="text" name="rule_target" placeholder="Target (numbers and periods)" value="{{ rule.target }}" required>
            </div>
            {% endfor %}
        </div>
        <button type="button" id="add_rule_button">Add Rule</button>
        <button type="submit">Save</button>
    </form>

    <script>
        document.getElementById('add_rule_button').addEventListener('click', function() {
            // Clone the rule row template
            var ruleRow = document.querySelector('.rule_row').cloneNode(true);
            // Clear input values
            ruleRow.querySelectorAll('input, select').forEach(function(input) {
                input.value = '';
            });
            // Append cloned rule row to the rules container
            document.getElementById('rules_container').appendChild(ruleRow);
        });
    </script>
{% endblock %}
